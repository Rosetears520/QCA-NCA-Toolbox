## 项目简介

QCA / NCA 结果整理工具箱 是一个基于 Gradio 的轻量级 Web 应用，旨在帮助研究者将定性比较分析（Qualitative Comparative Analysis，QCA）与必要条件分析（Necessary Condition Analysis，NCA）的原始输出，一键转换为学术论文可直接引用的 CSV／TSV 表格和可视化预览。    

您仅需复制-粘贴原始结果或组态表达式，即可完成数据清洗与格式化——无需编写任何脚本。

------

## 主要功能

| 功能                 | 说明                                                         |
| -------------------- | ------------------------------------------------------------ |
| **fsQCA 必要性整理** | 解析两段 `inclN RoN covN` 数据块，自动将正向与取反条件配对并汇总。 |
| **NCA 结果解析**     | 提取每个条件在 `ce_fdh` / `cr_fdh` 方法下的精确度、上限区域、范围、效应量 (d)、P 值等关键指标，生成整洁表。 |
| **QCA 组态表格**     | 将布尔表达式形式的组态路径（以 `+` 分隔）转换为“核心-边缘条件”展示表，并支持自定义符号。 |

------

## 环境依赖

- **Python 3.8+**
- **gradio == 5.23.0** （已验证避免“白屏”问题）
- **pandas >= 1.3.0**

将下列内容保存为 `requirements.txt`，然后执行：

```bash
pip install -r requirements.txt
gradio==5.23.0
pandas>=1.3.0
```

------

## 本地运行

```bash
# 克隆或下载仓库后：
python main.py
```

首次启动会在控制台看到提示：

```
应用启动成功！请在浏览器中打开 http://127.0.0.1:713
```

程序默认 **自动** 打开浏览器并加载该地址；如未弹出，可手动访问 `http://127.0.0.1:713`。

### 命令行可选参数

| 参数     | 说明                                                         | 默认值      |
| -------- | ------------------------------------------------------------ | ----------- |
| `--host` | 监听地址。`127.0.0.1` 仅本机访问；`0.0.0.0` 可供局域网访问。 | `127.0.0.1` |
| `--port` | 监听端口。                                                   | `713`       |

示例：在局域网开放端口 9999

```bash
python main.py --host 0.0.0.0 --port 9999
```

------

## 打包为 Windows 单文件 EXE

已在仓库发布页提供编译好的 `QCA_NCA_Toolbox.exe`，直接下载双击即可。
 如需自行打包，可使用 **pyinstaller**：

### 环境要求
- Python 3.12+
- 已安装所有在 `requirements.txt` 中列出的依赖包。
- 已安装 PyInstaller: `pip install pyinstaller`

### 打包命令
在项目根目录下，运行以下命令来生成应用程序：

```bash
pyinstaller --clean --noconfirm --onedir --console --icon="D:\python_project\qca_nca_app\qca_nca_logo.ico" --add-data "D:\python_project\qca_nca_app\qca_nca_logo.ico;." --collect-all gradio --collect-all gradio_client --collect-all safehttpx --collect-all groovy --hidden-import numpy --distpath dist --name QCA_NCA_Toolbox1.1 main.py
```

打包后双击 `dist/QCA_NCA_Toolbox/QCA_NCA_Toolbox.exe` 即可在本机或局域网使用（默认端口 713）。

------

## **功能详解与示例**

### **1\. fsQCA 必要性整理**

必要性分析用于判断某个条件是否为结果出现的“必不可少”的前提。

| 指标  | 解释                                                         |
| :---- | :----------------------------------------------------------- |
| inclN | **一致性 (Necessity consistency)**：衡量必要性关系的强弱。   |
| RoN   | **原始覆盖率 (Raw coverage)**：衡量该必要条件的重要性。      |
| covN  | **唯一覆盖率 (Unique coverage)**：衡量该条件独立解释结果的程度。 |

#### **1.1 输入示例**

（第一块为正向条件，第二块为取反条件，中间以空行分隔）

```txt
          inclN   RoN     covN
A         0.932432 0.888889 0.864198
B         0.810811 0.666667 0.753086
C         0.783784 0.622222 0.728395
~D        0.648649 0.444444 0.604938

          inclN   RoN     covN
~A        0.911111 0.846154 0.891304
~B        0.822222 0.692308 0.804348
~C        0.777778 0.615385 0.760870
D         0.733333 0.538462 0.717391
```


#### **1.2 解析结果**

工具会自动将正向条件与其取反条件相邻显示，便于对比。

| 条件变量 | 一致性   | 原始覆盖率 | 唯一覆盖率 |
| :------- | :------- | :--------- | :--------- |
| A        | 0.932432 | 0.888889   | 0.864198   |
| \~A      | 0.911111 | 0.846154   | 0.891304   |
| B        | 0.810811 | 0.666667   | 0.753086   |
| \~B      | 0.822222 | 0.692308   | 0.804348   |
| C        | 0.783784 | 0.622222   | 0.728395   |
| \~C      | 0.777778 | 0.615385   | 0.760870   |
| \~D      | 0.648649 | 0.444444   | 0.604938   |
| D        | 0.733333 | 0.538462   | 0.717391   |

### **2\. NCA 结果解析**

NCA 通过绘制“上限线”（ceiling line）来评估某个条件达到目标所需的最小阈值。

#### **2.1 输入示例**  

（可将多个条件的报告一并粘贴）

```txt
--------------------------------------------------------------------------------
NCA Parameters : C1 - Y
--------------------------------------------------------------------------------

Number of observations  100
Scope                   0.950
Xmin                    0.100
Xmax                    1.000
Ymin                    0.050
Ymax                    0.900

                  ce_fdh   cr_fdh
Ceiling zone       0.020    0.080
Effect size        0.030    0.100
# above            5        12
c-accuracy         95.0%    85.0%
Fit                98.0%    90.0%
p-value            0.010    0.050
p-accuracy         0.005    0.008


--------------------------------------------------------------------------------
NCA Parameters : C2 - Y
--------------------------------------------------------------------------------

Number of observations  100
Scope                   0.920
Xmin                    0.050
Xmax                    0.980
Ymin                    0.020
Ymax                    0.920

                  ce_fdh   cr_fdh
Ceiling zone       0.025    0.065
Effect size        0.035    0.090
# above            7         9
c-accuracy         92.0%    88.0%
Fit                95.0%    92.0%
p-value            0.020    0.030
p-accuracy         0.006    0.007


--------------------------------------------------------------------------------
NCA Parameters : C3 - Y
--------------------------------------------------------------------------------

Number of observations  100
Scope                   0.980
Xmin                    0.150
Xmax                    1.000
Ymin                    0.100
Ymax                    0.950

                  ce_fdh   cr_fdh
Ceiling zone       0.015    0.045
Effect size        0.025    0.070
# above            3         6
c-accuracy         98.0%    90.0%
Fit                99.0%    95.0%
p-value            0.005    0.025
p-accuracy         0.004    0.006
```



#### **2.2 解析结果**

“上限区域”即瓶颈面积；Scope 反映数据分布范围。

| 条件 | 方法   | 精确度 | 上限区域 | 范围  | 效应量(d) | P 值  |
| ---- | ------ | ------ | -------- | ----- | --------- | ----- |
| C1   | ce_fdh | 95.0%  | 0.020    | 0.950 | 0.030     | 0.010 |
| C1   | cr_fdh | 85.0%  | 0.080    | 0.950 | 0.100     | 0.050 |
| C2   | ce_fdh | 92.0%  | 0.025    | 0.920 | 0.035     | 0.020 |
| C2   | cr_fdh | 88.0%  | 0.065    | 0.920 | 0.090     | 0.030 |
| C3   | ce_fdh | 98.0%  | 0.015    | 0.980 | 0.025     | 0.005 |
| C3   | cr_fdh | 90.0%  | 0.045    | 0.980 | 0.070     | 0.025 |



### **3\. QCA 组态表格生成**

QCA 的最终解常以布尔表达式（组态路径）的形式给出。

#### **3.1 输入示例**

```txt
A*B*~C + A*C*D + ~B*~D*E
```



#### **3.2 生成表格**

（默认符号：存在=●, 缺失=⊗, 无关=空）

| 条件变量 | 组态 1 | 组态 2 | 组态 3 |
| :------- | :----- | :----- | :----- |
| A        | ●      | ●      |        |
| B        | ●      |        | ⊗      |
| C        | ⊗      | ●      |        |
| D        |        | ●      | ⊗      |
| E        |        |        | ●      |

**提示**：您可以在界面中自定义符号，例如 ✔ / ✖ / – 或 1 / 0 / ·。

------

### 反馈 & 贡献

如在使用过程中发现问题或有改进建议，欢迎 **Issue** / **Pull Request**！感谢你的支持与贡献。
